# vim:ts=4:sw=4:tw=0:wm=0:et:noic

"""Ask for directions in Google Maps

    https://www.google.com/maps/dir/?api=1
"""

from build_path import build_paths


def directions(lats, lons, names, start, end, waypoints):
    """Create URI for a map from 'start' to 'end' via possibly empty
'waypoints' list of intermediate points"""

    result = "https://www.google.com/maps/dir/?api=1"
    result += "&origin=%s,%s" % (lats[start], lons[start])
    result += "&destination=%s,%s" % (lats[end], lons[end])
    if waypoints:
        waypoints_string = "&waypoints="
        for index, wpt in enumerate(waypoints):
            if index != 0:
                waypoints_string += "%7C"
            waypoints_string += "%s,%s" % (lats[wpt], lons[wpt])
        result += waypoints_string
    return result


if __name__ == "__main__":

    from with_sqlite3 import get_data
    import pml

#   BOOTSTRAP_LINK = """
#   <link
#       rel="stylesheet"
#       href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
#       integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
#       crossorigin="anonymous"
#   >
#   """

    BOOTSTRAP_LINK = """<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">"""

#   JQUERY = """
#   <script
#       src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
#       integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
#       crossorigin="anonymous">
#   </script>
#   """

    JQUERY = """<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>"""

#   BOOTSTRAP = """
#   <script
#       src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"
#       integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
#       crossorigin="anonymous"
#       >
#   </script>
#   """

    BOOTSTRAP = """<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>"""

    STYLE = """
    table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
        vertical-align: center;
        padding: 3px;
        }
    th {
        text-align: center;
        font-size: 125%
        }
    h2 {
        text-align: center;
        }
    """

    xSTYLE = """
    .table-fixed thead {
                width: 97%;
    }

    .table-fixed tbody {
                height: 230px;
                overflow-y: auto;
                width: 100%;
    }

    .table-fixed thead, .table-fixed tbody, .table-fixed tr, .table-fixed td, .table-fixed th {
                display: block;
    }

    .table-fixed tbody td, .table-fixed thead > tr > th {
                float: left;
                border-bottom-width: 0;
    }

    """

    FILENAME = "output_file.db"
    data = get_data(FILENAME)
    lats, lons, texts, syms, names, usersorts, hrefs = zip(*data)

    doc = pml.XHTML("html")
    doc.title("Generated by %s" % __file__)
    doc.meta(charset="utf-8")
    doc.meta(name="viewport", content="width=device-width, initial-scale=1")
    doc += BOOTSTRAP_LINK
    doc += JQUERY
    doc += BOOTSTRAP
    doc.style(STYLE)
    doc.script("""
$(document).ready(function(){
    $(".btn").click(function(){
        $(this).addClass("btn-warning").removeClass("btn-primary");
    });
    $("#bobs_reset").click(function(){
        $(".btn-warning").addClass("btn-primary").removeClass("btn-warning");
    });
});
""")

    div = doc.body.div(klass="container")
    div.h2("Table of Map Routes")
    table = div.table(klass="table")

    tr = table.thead.tr()
    tr.th(
        "Link",
        colspan="1",
    )
    tr.th("Waypoints", colspan="3")

    tr = table.thead.tr()
    tr.th("UserSort",
        id="bobs_reset"
    )
    tr.th("From")
    tr.th("To")
    tr.th("Via")

    tbody = table.tbody()
    for start, end, waypoints in build_paths(data):
        tr = tbody.tr()
        href = directions(lats, lons, names, start, end, waypoints)
        td = tr.td.a(
            "%d to %d" % (usersorts[start], usersorts[end]),
            href=href,
            target="_blank",
            type="button",
            klass="btn btn-primary"
        )

        if 0 and hrefs[start]:
            tr.td.a(texts[start], href=hrefs[start], target="_blank")
        else:
            tr.td(texts[start])

        if hrefs[end]:
            tr.td.a(
                texts[end],
                href=hrefs[end],
                target="_blank",
                # type="button",
                # klass="btn btn-link"
            )
        else:
            tr.td(texts[end])

        td3 = tr.td()
        if waypoints:
            for index, waypoint in enumerate(waypoints):
                if index != 0:
                    td3.br()
                td3 += texts[waypoint]

    print("<!DOCTYPE HTML>\n" + str(doc))

# end of file
